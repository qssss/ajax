<!DOCTYPE html>
<html>
<head>
	<title>瀑布流</title>
	<meta charset="utf-8">
	<script type="text/javascript" src="jquery-1.9.1.js"></script>
	<script type="text/javascript" src="data/pics.json"></script>
</head>
<style type="text/css">
	button {display: block;width: 120px;height: 40px;background: #AB2121;color: #fff;line-height: 40px;text-align: center;border: none;outline: none;cursor: pointer;}
	body{margin: 0px; padding: 0px}
	ul{width: 1080px; margin: 30px auto;position: relative;overflow: hidden;}
	li{list-style: none; width: 248px; float: left; margin-left: 10px;position: relative;}
	li div{border: 1px solid black; padding: 10px; margin-bottom: 10px}
	li div img{width: 225px; display: block;cursor: pointer;}
	#layer {position: fixed;left: 0;right: 0;top: 0;bottom: 0;background: rgba(0,0,0,.5);display: none;}
	#layer img {position: absolute;left: 0;right: 0;top: 0;bottom: 0;margin:auto;}
	#layer span {position: absolute;right: 20px;top: 20px;font-size: 20px;color: #fff;cursor: pointer;width: 32px;height: 32px;background: url(close.png) no-repeat center center;}
	.item01.active {animation: mymove1 20s linear infinite forwards;-webkit-animation: mymove1 20s linear infinite forwards;}
	.item02.active {animation: mymove2 20s linear infinite forwards;-webkit-animation: mymove2 20s linear infinite forwards;}
	.item03.active {animation: mymove3 20s linear infinite forwards;-webkit-animation: mymove3 20s linear infinite forwards;}
	.item04.active {animation: mymove4 20s linear infinite forwards;-webkit-animation: mymove4 20s linear infinite forwards;}
	@keyframes mymove1 {
		from {top: -4000px;}
		to {top: 0;}
	}
	@keyframes mymove2 {
		from {top: -4000px;}
		to {top: 0;}
	}
	@keyframes mymove3 {
		from {top: -4000px;}
		to {top: 0;}
	}
	@keyframes mymove4 {
		from {top: -4000px;}
		to {top: 0;}
	}
</style>
<body>
	<ul id="oul">
		<li class="item01"></li>
		<li class="item02"></li>
		<li class="item03"></li>
		<li class="item04"></li>
	</ul>
	<div id="layer">
		<span></span>
	</div>
</body>
<script type="text/javascript">
	window.onload = function() {
		var arr = [];
		var isLogin = false;
		var oBtn = document.getElementById('btn');
		var oUl = document.getElementById('oul');
		var oLi = oUl.getElementsByTagName('li');
		var layer = document.getElementById('layer');
		var span = layer.getElementsByTagName('span')[0];
		getList();

		function getShort() {
			var index = 0;//假设最短的一行是第一列
			var iH = oLi[index].offsetHeight;
			for(var j = 0;j < oLi.length;j++) {
				if(oLi[j].offsetHeight < iH) {
					iH = oLi[j].offsetHeight;
					index = j;
				}
			}
			return index;
		}

		function getList() {
			$.ajax({
				url: 'data/pics.json',
				type:'GET',
				success: function(data) {
					arr = eval(data);
					console.log(arr)
					isLogin = true;
					if (isLogin) {
						for(var i = 0;i < arr.length;i++) {
							var div = document.createElement('div');
							var img =  document.createElement('img');
							img.src = arr[i].image;
							img.style.width = '225' + 'px';
							img.style.height = 225 * arr[i].height / arr[i].width + 'px';
							img.title = '点我查看大图';
							img.id = arr[i].id;
							img.index = i;
							var p = document.createElement('p');
							p.innerHTML = arr[i].title;
							div.appendChild(img);
							div.appendChild(p);
							var short = getShort();
							oLi[short].appendChild(div);
						}
						$('#oul li').addClass('active');
					}					
				},
				error: function(error) {
					console.log('出错了');
				}
			})
		}
		var short = getShort();
		var o = oLi[short];
		// 动画重复运动时事件
		o.addEventListener("webkitAnimationIteration", function() {
			// alert('要结束了');
			getRepeat();
			setTimeout(function() {
				// $('ul').eq(1).find('li').removeClass('active');
			},0);
			$('ul').eq(0).find('li').addClass('active');
		    
		})

		function getRepeat() {
			var oul2 = $('#oul').clone(true);
			$('body').prepend(oul2);
			setTimeout(function(){
				$('body').find('ul').next().remove();
			},15000)
		}
		
		//滚动鼠标时
		// window.onscroll = function() {
		// 	var sTop = document.body.scrollTop||document.documentElement.scrollTop;
		// 	var oTop = oUl.offsetTop;
		// 	var lTop = oLi[3].offsetHeight;
		// 	var clientHeight = window.screen.height;
		// 	if(lTop + oTop - sTop < clientHeight) {
		// 		getList();
		// 		isLogin = false;
		// 		console.log('要加载第二页了')
		// 	}
		// }

		oUl.addEventListener('click',function(e) {
			var e = e || window.event;
			var target = e.target || e.srcElement;
			if(target.nodeName.toLowerCase() == 'img') {
				for(var i = 0;i<arr.length;i++) {
					if(arr[i].id == target.id) {
						var img = document.createElement('img');
						img.src = arr[i].image;
						img.style.height = '80%';
						img.style.width = 'auto';
						layer.appendChild(img);
						layer.style.display = 'block';
					}
				}
			}
		})

		span.onclick = function() {
			layer.style.display = 'none';
		}
	}
	
</script>
</html>